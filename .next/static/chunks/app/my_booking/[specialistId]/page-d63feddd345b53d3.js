(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[267],{54492:function(e,s,t){Promise.resolve().then(t.bind(t,92119)),Promise.resolve().then(t.bind(t,72716))},92119:function(e,s,t){"use strict";var l=t(57437);t(2265),s.default=e=>{let{children:s}=e;return(0,l.jsx)(l.Fragment,{children:(0,l.jsx)("div",{className:"max-w-[2520px] min-h-screen mx-auto xl:px-20 md:px-10 sm:px-2 px-4",children:s})})}},55418:function(e,s,t){"use strict";var l=t(2265);s.Z=()=>{let[e,s]=(0,l.useState)(null),[t,r]=(0,l.useState)(),[a,i]=(0,l.useState)(!0),[n,c]=(0,l.useState)(null);return(0,l.useEffect)(()=>{var e;let t=window.Telegram.WebApp;t.ready();let l=null===(e=t.initDataUnsafe)||void 0===e?void 0:e.user;if(l){s(l);let e="6874087551:AAHHCPMYy9JXgHVBavUdce_YjoXWgd0Fuew";fetch("https://api.telegram.org/bot".concat(e,"/getUserProfilePhotos?user_id=").concat(l.id)).then(e=>{if(!e.ok)throw Error("Ошибка получения данных от Telegram API");return e.json()}).then(s=>{var t,l;if((null==s?void 0:null===(l=s.result)||void 0===l?void 0:null===(t=l.photos)||void 0===t?void 0:t.length)>0){let t=s.result.photos[0][0].file_id;return fetch("https://api.telegram.org/bot".concat(e,"/getFile?file_id=").concat(t))}throw Error("Фотографии профиля не найдены")}).then(e=>{if(!e.ok)throw Error("Ошибка получения файла с Telegram API");return e.json()}).then(s=>{var t;if(null==s?void 0:null===(t=s.result)||void 0===t?void 0:t.file_path)r("https://api.telegram.org/file/bot".concat(e,"/").concat(s.result.file_path));else throw Error("Путь к файлу не найден")}).catch(e=>{console.error("Ошибка получения фото профиля:",e),c(e.message),r("/placeholder-image.jpg")}).finally(()=>i(!1))}else i(!1)},[]),{telegram_user:e,userPhoto:t,loading:a,error:n}}},72716:function(e,s,t){"use strict";var l=t(57437),r=t(55418),a=t(48769),i=t(58710),n=t(9851),c=t(61572),d=t(27901),o=t(92762),m=t(62737),h=t.n(m),x=t(16463),u=t(2265),f=t(41942),p=t(16356),j=t(23580);t(44193),t(75108),s.default=e=>{let{appointment:s}=e,t=(0,x.useRouter)(),{telegram_user:m,userPhoto:v}=(0,r.Z)(),[N,g]=(0,u.useState)(s||[]),[b,w]=(0,u.useState)(!1),[y,k]=(0,u.useState)(""),[E,_]=(0,u.useState)(null),[S,C]=(0,u.useState)(null),[A,Y]=(0,u.useState)(N);(0,u.useEffect)(()=>{let e=window.Telegram.WebApp;e.ready(),e.BackButton.show(),e.BackButton.onClick(()=>t.back()),e.MainButton.hide(),s&&s.length>0&&(g([...s].reverse()),Y([...s].reverse()))},[s]),(0,u.useEffect)(()=>{S?Y(N.filter(e=>h()(e.date,"DD.MM.YYYY").isSame(h()(S),"day"))):Y(N)},[S,N]);let T=async()=>{if(!y.trim()){j.Am.error("Пожалуйста, укажите причину отмены");return}if(null!==E)try{(await fetch("/api/appointments?id=".concat(E),{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:y})})).ok?(g(e=>e.filter(e=>e.id!==E)),j.Am.success("Запись успешно отменена"),w(!1)):j.Am.error("Не удалось отменить запись")}catch(e){console.error("Ошибка при отмене записи:",e),j.Am.error("Произошла ошибка при отмене записи")}},D=e=>{_(e),k(""),w(!0)};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(j.Ix,{}),(0,l.jsx)(a.Z,{title:"Причина отмены",visible:b,onOk:T,onCancel:()=>w(!1),okText:"Подтвердить",cancelText:"Отмена",children:(0,l.jsx)(i.Z,{value:y,onChange:e=>k(e.target.value),placeholder:"Введите причину отмены"})}),(0,l.jsxs)("div",{className:"bg-white shadow-md rounded-lg flex items-center justify-between mb-4",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"p-2",children:(0,l.jsx)(n.C,{src:v,size:48})}),(0,l.jsx)("div",{className:"pl-2 font-medium",children:null==m?void 0:m.first_name})]}),(0,l.jsx)("div",{className:"pr-2",children:(0,l.jsx)(c.Z,{width:150,src:"/logo.svg"})})]}),(0,l.jsxs)("div",{className:"max-w-md mx-auto bg-white shadow-md rounded-lg p-6",children:[(0,l.jsxs)("div",{className:"border-b pb-4",children:[(0,l.jsx)("h2",{className:"text-xl font-normal mb-2",children:"Запись ко мне"}),(0,l.jsx)("span",{className:"text-sm",children:"Актуальные и прошедшие записи клиентов"}),(0,l.jsx)("div",{className:"mt-2",children:(0,l.jsx)(d.Z,{locale:o.Z,onChange:e=>C(e),placeholder:"Выберите дату",format:"DD.MM.YYYY",style:{width:"100%"}})})]}),(0,l.jsx)("div",{children:A&&A.length>0?A.map(e=>(0,l.jsxs)("div",{className:"mt-4 p-4 border-b",children:[(0,l.jsxs)("div",{className:"mb-2",children:[(0,l.jsxs)("div",{className:"flex items-center mb-1",children:[(0,l.jsx)(p.FFD,{size:24,className:"bg-blue-500 p-1 rounded-lg mr-2",color:"white"}),(0,l.jsx)("div",{className:"mr-2",children:"Дата:"}),(0,l.jsx)("span",{className:"font-semibold",children:e.date})]}),(0,l.jsxs)("div",{className:"flex items-center mb-1",children:[(0,l.jsx)(p.iNe,{size:24,className:"bg-red-500 p-1 rounded-lg mr-2",color:"white"}),(0,l.jsx)("div",{className:"mr-2",children:"Время:"}),(0,l.jsx)("span",{className:"font-semibold",children:e.time})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center mb-1",children:[(0,l.jsx)(p.Vyx,{size:24,className:"bg-yellow-500 p-1 rounded-lg mr-2",color:"white"}),(0,l.jsx)("div",{className:"mr-2",children:"Клиент:"}),(0,l.jsxs)("span",{className:"font-semibold",children:[e.firstName," ",e.lastName]})]}),(0,l.jsxs)("div",{className:"flex items-center mb-1",children:[(0,l.jsx)(p.IXo,{size:24,className:"bg-orange-500 p-1 rounded-lg mr-2",color:"white"}),(0,l.jsx)("div",{className:"mr-2",children:"Телефон:"}),(0,l.jsx)("span",{className:"font-semibold",children:e.phone})]})]}),(0,l.jsxs)("div",{className:"flex justify-center",children:[(0,l.jsx)("div",{className:"text-center pt-2 mt-2",children:(0,l.jsx)("button",{onClick:()=>t.push("/perezapis/".concat(e.id)),className:"bg-green-500 rounded-full px-5 py-3 mt-4 text-white text-sm",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(f.ffH,{className:"mr-2"}),"Перезаписать"]})})}),(0,l.jsx)("div",{className:"text-center pt-2 mt-2 ml-4",children:(0,l.jsx)("button",{onClick:()=>D(e.id),className:"bg-red-500 rounded-full px-9 py-3 mt-4 text-white text-sm",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(p.xg7,{className:"mr-2"}),"Отменить"]})})})]})]},e.id)):(0,l.jsx)("p",{className:"text-center text-sm",children:"Записей нет"})})]})]})}},75108:function(){}},function(e){e.O(0,[143,974,51,699,209,127,138,710,421,971,23,744],function(){return e(e.s=54492)}),_N_E=e.O()}]);