(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[278],{44928:function(e,t,a){Promise.resolve().then(a.bind(a,92119)),Promise.resolve().then(a.bind(a,93159))},92119:function(e,t,a){"use strict";var s=a(57437);a(2265),t.default=e=>{let{children:t}=e;return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{className:"max-w-[2520px] min-h-screen mx-auto xl:px-20 md:px-10 sm:px-2 px-4",children:t})})}},93159:function(e,t,a){"use strict";var s=a(57437),l=a(55418),r=a(9851),i=a(61572),n=a(16463),o=a(2265),c=a(23580);a(44193),t.default=e=>{let{specialistId:t,grafik:a}=e,[d,m]=(0,o.useState)(a?(e=>{let t=[],a=new Map;return null==e||e.forEach(e=>{let t="".concat(e.startTime,"-").concat(e.endTime,"-").concat(e.interval);a.has(t)?a.get(t).selectedDays.push(e.dayOfWeek):a.set(t,{grafikName:"grafik_".concat(e.dayOfWeek,"_").concat(Date.now()),specialistId:e.specialistId,startTime:e.startTime,endTime:e.endTime,interval:e.interval,selectedDays:[e.dayOfWeek],id:e.id})}),a.forEach(e=>t.push(e)),t})(a):[{grafikName:"grafik_1_".concat(Date.now()),specialistId:t,startTime:"00:00",endTime:"00:00",interval:15,selectedDays:[]}]),[u,h]=(0,o.useState)(2),x=[{label:"ПН",value:1},{label:"ВТ",value:2},{label:"СР",value:3},{label:"ЧТ",value:4},{label:"ПТ",value:5},{label:"СБ",value:6},{label:"ВС",value:0}],f=(e,t)=>{if(d.some((a,s)=>s!==e&&a.selectedDays.includes(t))){c.Am.error("Этот день уже добавлен в другой график!");return}m(a=>a.map((a,s)=>{if(s===e){let e=a.selectedDays.includes(t)?a.selectedDays.filter(e=>e!==t):[...a.selectedDays,t];return{...a,selectedDays:e}}return a}))},p=async(e,a)=>{e.preventDefault();let s=d[a];if(0===s.selectedDays.length){c.Am.error("Пожалуйста, выберите хотя бы один день недели.");return}(await fetch("/api/grafik",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({grafikName:s.grafikName,startTime:s.startTime,endTime:s.endTime,interval:s.interval,specialistId:t,daysOfWeek:s.selectedDays})})).ok?c.Am.success("График успешно сохранён"):c.Am.error("Ошибка при создании графика")},v=async e=>{let a=d[e];(await fetch("/api/grafik",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a.id,specialistId:t,daysOfWeek:a.selectedDays})})).ok?(c.Am.success("График успешно удалён"),m(t=>t.filter((t,a)=>a!==e))):c.Am.error("Ошибка при удалении графика")},b=(0,n.useRouter)(),{telegram_user:g,userPhoto:y,loading:j,error:N}=(0,l.Z)();return(0,o.useEffect)(()=>{let e=window.Telegram.WebApp;e.ready(),e.BackButton.show(),e.BackButton.onClick(()=>b.back()),e.MainButton.hide()},[]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"bg-white shadow-md rounded-lg flex items-center justify-between mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"p-2",children:(0,s.jsx)(r.C,{src:y,size:48})}),(0,s.jsx)("div",{className:"pl-2 font-medium",children:null==g?void 0:g.first_name})]}),(0,s.jsx)("div",{className:"pr-2",children:(0,s.jsx)(i.Z,{width:150,src:"/logo.svg"})})]}),(0,s.jsxs)("div",{className:"max-w-md mx-auto bg-white shadow-md rounded-lg p-6 ",children:[(0,s.jsxs)("div",{className:" border-b pb-4",children:[(0,s.jsx)("h2",{className:"text-xl font-normal pb-2 ",children:"Мой график"}),(0,s.jsxs)("span",{className:" text-sm",children:["Добавляйте и удаляйте график на разные дни недели"," "]})]}),(0,s.jsx)(c.Ix,{}),d.map((e,t)=>(0,s.jsxs)("form",{onSubmit:e=>p(e,t),className:"mb-6",children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{htmlFor:"start-time-".concat(t),className:"block text-sm font-medium text-gray-700 mt-6 mb-2",children:"Начало работы:"}),(0,s.jsx)("input",{id:"start-time-".concat(t),type:"time",value:e.startTime,onChange:e=>m(a=>a.map((a,s)=>s===t?{...a,startTime:e.target.value}:a)),className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm",required:!0})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{htmlFor:"end-time-".concat(t),className:"block text-sm font-medium text-gray-700 mb-2",children:"Конец работы:"}),(0,s.jsx)("input",{id:"end-time-".concat(t),type:"time",value:e.endTime,onChange:e=>m(a=>a.map((a,s)=>s===t?{...a,endTime:e.target.value}:a)),className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm",required:!0})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{htmlFor:"interval-".concat(t),className:"block text-sm font-medium text-gray-700 mb-2",children:"Время на клиента (минуты):"}),(0,s.jsxs)("select",{id:"interval-".concat(t),value:e.interval,onChange:e=>m(a=>a.map((a,s)=>s===t?{...a,interval:Number(e.target.value)}:a)),className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm",children:[(0,s.jsx)("option",{value:15,children:"15"}),(0,s.jsx)("option",{value:30,children:"30"}),(0,s.jsx)("option",{value:45,children:"45"}),(0,s.jsx)("option",{value:60,children:"60"}),(0,s.jsx)("option",{value:60,children:"75"}),(0,s.jsx)("option",{value:60,children:"90"}),(0,s.jsx)("option",{value:60,children:"105"}),(0,s.jsx)("option",{value:60,children:"120"}),(0,s.jsx)("option",{value:60,children:"135"}),(0,s.jsx)("option",{value:60,children:"150"})]})]}),(0,s.jsx)("div",{className:"flex justify-between mt-6 text-sm",children:x.map(a=>(0,s.jsx)("button",{type:"button",className:"py-1 px-2 rounded-md transition-colors ".concat(e.selectedDays.includes(a.value)?"bg-blue-500 text-white":"bg-gray-200 text-gray-700"),onClick:()=>f(t,a.value),children:a.label},a.value))}),(0,s.jsxs)("div",{className:"mt-6 flex space-x-4",children:[(0,s.jsx)("button",{type:"submit",className:"w-full bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-500 transition-colors text-sm",children:"Сохранить"}),(0,s.jsx)("button",{type:"button",onClick:()=>v(t),className:"w-full bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700 transition-colors text-sm",children:"Удалить"})]})]},t)),(0,s.jsx)("div",{className:"mt-6 flex justify-center",children:(0,s.jsx)("button",{type:"button",onClick:()=>{let e="grafik_".concat(u,"_").concat(Date.now());m(a=>[...a,{grafikName:e,specialistId:t,startTime:"00:00",endTime:"00:00",interval:15,selectedDays:[]}]),h(u+1)},className:"bg-green-500 text-white py-2 px-4 rounded-md hover:bg-green-600 transition-colors text-sm",children:"+ Добавить график"})})]})]})}},55418:function(e,t,a){"use strict";var s=a(2265);t.Z=()=>{let[e,t]=(0,s.useState)(null),[a,l]=(0,s.useState)(),[r,i]=(0,s.useState)(!0),[n,o]=(0,s.useState)(null);return(0,s.useEffect)(()=>{var e;let a=window.Telegram.WebApp;a.ready();let s=null===(e=a.initDataUnsafe)||void 0===e?void 0:e.user;if(s){t(s);let e="6874087551:AAHHCPMYy9JXgHVBavUdce_YjoXWgd0Fuew";fetch("https://api.telegram.org/bot".concat(e,"/getUserProfilePhotos?user_id=").concat(s.id)).then(e=>{if(!e.ok)throw Error("Ошибка получения данных от Telegram API");return e.json()}).then(t=>{var a,s;if((null==t?void 0:null===(s=t.result)||void 0===s?void 0:null===(a=s.photos)||void 0===a?void 0:a.length)>0){let a=t.result.photos[0][0].file_id;return fetch("https://api.telegram.org/bot".concat(e,"/getFile?file_id=").concat(a))}throw Error("Фотографии профиля не найдены")}).then(e=>{if(!e.ok)throw Error("Ошибка получения файла с Telegram API");return e.json()}).then(t=>{var a;if(null==t?void 0:null===(a=t.result)||void 0===a?void 0:a.file_path)l("https://api.telegram.org/file/bot".concat(e,"/").concat(t.result.file_path));else throw Error("Путь к файлу не найден")}).catch(e=>{console.error("Ошибка получения фото профиля:",e),o(e.message),l("/placeholder-image.jpg")}).finally(()=>i(!1))}else i(!1)},[]),{telegram_user:e,userPhoto:a,loading:r,error:n}}}},function(e){e.O(0,[143,209,127,971,23,744],function(){return e(e.s=44928)}),_N_E=e.O()}]);