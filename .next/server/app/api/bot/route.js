"use strict";(()=>{var e={};e.id=62,e.ids=[62],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},50852:e=>{e.exports=require("async_hooks")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},85477:e=>{e.exports=require("punycode")},63477:e=>{e.exports=require("querystring")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},76224:e=>{e.exports=require("tty")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},62088:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>y,patchFetch:()=>w,requestAsyncStorage:()=>h,routeModule:()=>g,serverHooks:()=>f,staticGenerationAsyncStorage:()=>q});var a={};t.r(a),t.d(a,{POST:()=>x});var s=t(49303),i=t(88716),o=t(60670),p=t(87070),n=t(66088),u=t.n(n),l=t(53524);let d=globalThis.prisma||new l.PrismaClient,c=new(u())("7655736393:AAGYAPPjBo1WWKhAXtcUMj0FsTWH35Y7D8g"),m="https://3afa-178-167-76-68.ngrok-free.app";async function x(e){let r=await e.json();return c.processUpdate(r),p.NextResponse.json({status:"ok"})}c.setWebHook("https://3afa-178-167-76-68.ngrok-free.app/api/bot"),c.onText(/\/start/,async e=>{let r=e.chat.id,t=r.toString();try{await c.sendMessage(r,"Проверка связи!"),await d.user.findUnique({where:{telegramId:t}})?await c.sendMessage(r,"Вы зарегистрированы"):await c.sendMessage(r,"Вы не зарегистрированы")}catch(e){console.error("Ошибка при выполнении команды /start:",e),await c.sendMessage(r,"Произошла ошибка. Попробуйте еще раз.")}}),c.on("callback_query",async e=>{let r=e.message?.chat.id,t=e.from.id.toString();if(!r)return;let a=await d.user.findUnique({where:{telegramId:t}});if(!a){c.sendMessage(r,"Пользователь не найден. Пожалуйста, зарегистрируйтесь сначала.");return}if("client"===e.data){let e={reply_markup:{inline_keyboard:[[{text:"Перейти в приложение",web_app:{url:`${m}`}}]]}},t=`${m}/33.png`;c.sendPhoto(r,t,{caption:"Вы выбрали профиль клиента.",reply_markup:e.reply_markup})}if("specialist"===e.data)try{await d.user.update({where:{telegramId:t},data:{isMaster:!0}}),await d.specialist.create({data:{userId:a.telegramId,chatId:r.toString(),firstName:a.firstName,lastName:a.lastName,username:a.username,isMaster:!0}});let e={reply_markup:{inline_keyboard:[[{text:"Перейти в приложение",web_app:{url:`${m}`}}]]}},s=`${m}/22.png`;c.sendPhoto(r,s,{caption:`Вы специалист. Вот ваша уникальная ссылка для записи: https://t.me/naznach_twa_bot?start=${r} `,reply_markup:e.reply_markup})}catch(e){console.error("Ошибка при регистрации специалиста:",e),c.sendMessage(r,"Произошла ошибка при регистрации. Попробуйте еще раз.")}});let g=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/bot/route",pathname:"/api/bot",filename:"route",bundlePath:"app/api/bot/route"},resolvedPagePath:"D:\\Projects\\NEWWEBAPPTELEGA\\web-app\\src\\app\\api\\bot\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:h,staticGenerationAsyncStorage:q,serverHooks:f}=g,y="/api/bot/route";function w(){return(0,o.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:q})}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[948,972,88],()=>t(62088));module.exports=a})();