"use strict";(()=>{var e={};e.id=282,e.ids=[282],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},50852:e=>{e.exports=require("async_hooks")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},85477:e=>{e.exports=require("punycode")},63477:e=>{e.exports=require("querystring")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},76224:e=>{e.exports=require("tty")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},77712:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>R,requestAsyncStorage:()=>j,routeModule:()=>f,serverHooks:()=>N,staticGenerationAsyncStorage:()=>$});var s={};r.r(s),r.d(s,{DELETE:()=>h,GET:()=>w,POST:()=>m,PUT:()=>q});var n=r(49303),o=r(88716),a=r(60670),i=r(87070),p=r(53524),u=r(66088),l=r.n(u);let c=new p.PrismaClient,x=new(l())("7655736393:AAGYAPPjBo1WWKhAXtcUMj0FsTWH35Y7D8g",{polling:!1}),d="https://3afa-178-167-76-68.ngrok-free.app";async function m(e){try{let{firstName:t,lastName:r,phone:s,specialistId:n,date:o,time:a,clientId:p,specialistName:u,specialistLastName:l,specialistPhone:m,specialistCategory:w,specialistAddress:h,specialistPrice:q}=await e.json(),f=await c.appointments.create({data:{firstName:t,lastName:r,phone:s,specialistId:n,date:o,time:a,clientId:p,specialistName:u,specialistLastName:l,specialistPhone:m,specialistCategory:w,specialistAddress:h,specialistPrice:q}}),j=parseInt(n),$=parseInt(p),N=`${d}/44.png`;return await x.sendPhoto($,N,{caption:`🔔 Вы записались 🔔

 📆 Дата: ${o} 
 ⌚ Время: ${a} 
 💰 К оплате: ${q} руб. 
 😀 Мастер: ${u} ${l} 
 📞 Телефон: ${m}`,reply_markup:{inline_keyboard:[[{text:"Перейти в приложение",web_app:{url:`${d}`}}]]}}),await x.sendPhoto(j,N,{caption:`🔔 У Вас новая запись 🔔

 😀 ${t} ${r} 
 📆 Дата: ${o} 
 ⌚ Время: ${a} 
 📞 Телефон: ${s} 
 💰 К оплате: ${q} руб.`,reply_markup:{inline_keyboard:[[{text:"Перейти в приложение",web_app:{url:`${d}`}}]]}}),i.NextResponse.json({appointment:f})}catch(e){return i.NextResponse.json({error:"Ошибка при создании записи"},{status:500})}}async function w(e){try{let{searchParams:t}=new URL(e.url),r=t.get("specialistId"),s=t.get("date");if(!r||!s)return i.NextResponse.json({error:"Неверные параметры запроса"},{status:400});let n=await c.appointments.findMany({where:{specialistId:r,date:s},select:{time:!0}});return i.NextResponse.json(n)}catch(e){return i.NextResponse.json({error:"Ошибка при получении записей"},{status:500})}}async function h(e){try{let{searchParams:t}=new URL(e.url),r=t.get("id"),{reason:s}=await e.json();if(!s)return i.NextResponse.json({error:"Пожалуйста, укажите причину отмены"},{status:400});if(!r)return i.NextResponse.json({error:"Неверные параметры запроса"},{status:400});let n=parseInt(r);if(isNaN(n))return i.NextResponse.json({error:"Неверный формат ID"},{status:400});let o=await c.appointments.findUnique({where:{id:n}});if(!o)return console.error(`Запись с ID ${n} не найдена`),i.NextResponse.json({error:"Запись не найдена"},{status:404});if(await c.appointments.delete({where:{id:n}}),o.clientId){let e=parseInt(o.clientId),t=`${d}/55.png`,r=`❌ Ваша запись была отменена.

 📆 Дата: ${o.date}
 ⌚ Время: ${o.time}
 😀 Мастер: ${o.specialistName} ${o.specialistLastName}
 📞 Телефон: ${o.specialistPhone} 
  ❗ Причина: ${s}`;await x.sendPhoto(e,t,{caption:r,reply_markup:{inline_keyboard:[[{text:"Перейти в приложение",web_app:{url:`${d}`}}]]}})}return i.NextResponse.json({message:"Запись успешно удалена"})}catch(e){return console.error("Ошибка при удалении записи:",e),i.NextResponse.json({error:"Ошибка при удалении записи"},{status:500})}}async function q(e){try{let{searchParams:t}=new URL(e.url),r=t.get("id"),{date:s,time:n}=await e.json();if(!r)return i.NextResponse.json({error:"Неверные параметры запроса"},{status:400});let o=parseInt(r);if(isNaN(o))return i.NextResponse.json({error:"Неверный формат ID"},{status:400});if(!await c.appointments.findUnique({where:{id:o}}))return console.error(`Запись с ID ${o} не найдена`),i.NextResponse.json({error:"Запись не найдена"},{status:404});return await c.appointments.update({where:{id:o},data:{date:s,time:n}}),i.NextResponse.json({message:"Запись успешно перезаписана"})}catch(e){return console.error("Ошибка при перезаписи:",e),i.NextResponse.json({error:"Ошибка при перезаписи"},{status:500})}}let f=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/appointments/route",pathname:"/api/appointments",filename:"route",bundlePath:"app/api/appointments/route"},resolvedPagePath:"D:\\Projects\\NEWWEBAPPTELEGA\\web-app\\src\\app\\api\\appointments\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:j,staticGenerationAsyncStorage:$,serverHooks:N}=f,y="/api/appointments/route";function R(){return(0,a.patchFetch)({serverHooks:N,staticGenerationAsyncStorage:$})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,972,88],()=>r(77712));module.exports=s})();