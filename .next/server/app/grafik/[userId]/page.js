(()=>{var e={};e.id=278,e.ids=[278],e.modules={53524:e=>{"use strict";e.exports=require("@prisma/client")},47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},71017:e=>{"use strict";e.exports=require("path")},57310:e=>{"use strict";e.exports=require("url")},46543:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d}),r(39876),r(32029),r(35866);var s=r(23191),a=r(88716),i=r(37922),n=r.n(i),l=r(95231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);r.d(t,o);let d=["",{children:["grafik",{children:["[userId]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,39876)),"D:\\Projects\\NEWWEBAPPTELEGA\\web-app\\src\\app\\grafik\\[userId]\\page.tsx"]}]},{}]},{metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,32029)),"D:\\Projects\\NEWWEBAPPTELEGA\\web-app\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,35866,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],c=["D:\\Projects\\NEWWEBAPPTELEGA\\web-app\\src\\app\\grafik\\[userId]\\page.tsx"],u="/grafik/[userId]/page",m={require:r,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/grafik/[userId]/page",pathname:"/grafik/[userId]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},68080:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,12994,23)),Promise.resolve().then(r.t.bind(r,96114,23)),Promise.resolve().then(r.t.bind(r,9727,23)),Promise.resolve().then(r.t.bind(r,79671,23)),Promise.resolve().then(r.t.bind(r,41868,23)),Promise.resolve().then(r.t.bind(r,84759,23))},95528:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,44064,23))},17953:(e,t,r)=>{Promise.resolve().then(r.bind(r,49762)),Promise.resolve().then(r.bind(r,8389))},49762:(e,t,r)=>{"use strict";r.d(t,{default:()=>a});var s=r(10326);r(17577);let a=({children:e})=>s.jsx(s.Fragment,{children:s.jsx("div",{className:"max-w-[2520px] min-h-screen mx-auto xl:px-20 md:px-10 sm:px-2 px-4",children:e})})},8389:(e,t,r)=>{"use strict";r.d(t,{default:()=>c});var s=r(10326),a=r(89500),i=r(25605),n=r(62811),l=r(35047),o=r(17577),d=r(31190);r(45996);let c=({specialistId:e,grafik:t})=>{let[r,c]=(0,o.useState)(t?(e=>{let t=[],r=new Map;return e?.forEach(e=>{let t=`${e.startTime}-${e.endTime}-${e.interval}`;r.has(t)?r.get(t).selectedDays.push(e.dayOfWeek):r.set(t,{grafikName:`grafik_${e.dayOfWeek}_${Date.now()}`,specialistId:e.specialistId,startTime:e.startTime,endTime:e.endTime,interval:e.interval,selectedDays:[e.dayOfWeek],id:e.id})}),r.forEach(e=>t.push(e)),t})(t):[{grafikName:`grafik_1_${Date.now()}`,specialistId:e,startTime:"00:00",endTime:"00:00",interval:15,selectedDays:[]}]),[u,m]=(0,o.useState)(2),p=[{label:"ПН",value:1},{label:"ВТ",value:2},{label:"СР",value:3},{label:"ЧТ",value:4},{label:"ПТ",value:5},{label:"СБ",value:6},{label:"ВС",value:0}],x=(e,t)=>{if(r.some((r,s)=>s!==e&&r.selectedDays.includes(t))){d.Am.error("Этот день уже добавлен в другой график!");return}c(r=>r.map((r,s)=>{if(s===e){let e=r.selectedDays.includes(t)?r.selectedDays.filter(e=>e!==t):[...r.selectedDays,t];return{...r,selectedDays:e}}return r}))},h=async(t,s)=>{t.preventDefault();let a=r[s];if(0===a.selectedDays.length){d.Am.error("Пожалуйста, выберите хотя бы один день недели.");return}(await fetch("/api/grafik",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({grafikName:a.grafikName,startTime:a.startTime,endTime:a.endTime,interval:a.interval,specialistId:e,daysOfWeek:a.selectedDays})})).ok?d.Am.success("График успешно сохранён"):d.Am.error("Ошибка при создании графика")},f=async t=>{let s=r[t];(await fetch("/api/grafik",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:s.id,specialistId:e,daysOfWeek:s.selectedDays})})).ok?(d.Am.success("График успешно удалён"),c(e=>e.filter((e,r)=>r!==t))):d.Am.error("Ошибка при удалении графика")},g=(0,l.useRouter)(),{telegram_user:b,userPhoto:v,loading:y,error:j}=(0,a.Z)();return(0,o.useEffect)(()=>{let e=window.Telegram.WebApp;e.ready(),e.BackButton.show(),e.BackButton.onClick(()=>g.back()),e.MainButton.hide()},[]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"bg-white shadow-md rounded-lg flex items-center justify-between mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[s.jsx("div",{className:"p-2",children:s.jsx(i.C,{src:v,size:48})}),s.jsx("div",{className:"pl-2 font-medium",children:b?.first_name})]}),s.jsx("div",{className:"pr-2",children:s.jsx(n.Z,{width:150,src:"/logo.svg"})})]}),(0,s.jsxs)("div",{className:"max-w-md mx-auto bg-white shadow-md rounded-lg p-6 ",children:[(0,s.jsxs)("div",{className:" border-b pb-4",children:[s.jsx("h2",{className:"text-xl font-normal pb-2 ",children:"Мой график"}),(0,s.jsxs)("span",{className:" text-sm",children:["Добавляйте и удаляйте график на разные дни недели"," "]})]}),s.jsx(d.Ix,{}),r.map((e,t)=>(0,s.jsxs)("form",{onSubmit:e=>h(e,t),className:"mb-6",children:[(0,s.jsxs)("div",{className:"mb-4",children:[s.jsx("label",{htmlFor:`start-time-${t}`,className:"block text-sm font-medium text-gray-700 mt-6 mb-2",children:"Начало работы:"}),s.jsx("input",{id:`start-time-${t}`,type:"time",value:e.startTime,onChange:e=>c(r=>r.map((r,s)=>s===t?{...r,startTime:e.target.value}:r)),className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm",required:!0})]}),(0,s.jsxs)("div",{className:"mb-4",children:[s.jsx("label",{htmlFor:`end-time-${t}`,className:"block text-sm font-medium text-gray-700 mb-2",children:"Конец работы:"}),s.jsx("input",{id:`end-time-${t}`,type:"time",value:e.endTime,onChange:e=>c(r=>r.map((r,s)=>s===t?{...r,endTime:e.target.value}:r)),className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm",required:!0})]}),(0,s.jsxs)("div",{className:"mb-4",children:[s.jsx("label",{htmlFor:`interval-${t}`,className:"block text-sm font-medium text-gray-700 mb-2",children:"Время на клиента (минуты):"}),(0,s.jsxs)("select",{id:`interval-${t}`,value:e.interval,onChange:e=>c(r=>r.map((r,s)=>s===t?{...r,interval:Number(e.target.value)}:r)),className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm",children:[s.jsx("option",{value:15,children:"15"}),s.jsx("option",{value:30,children:"30"}),s.jsx("option",{value:45,children:"45"}),s.jsx("option",{value:60,children:"60"}),s.jsx("option",{value:60,children:"75"}),s.jsx("option",{value:60,children:"90"}),s.jsx("option",{value:60,children:"105"}),s.jsx("option",{value:60,children:"120"}),s.jsx("option",{value:60,children:"135"}),s.jsx("option",{value:60,children:"150"})]})]}),s.jsx("div",{className:"flex justify-between mt-6 text-sm",children:p.map(r=>s.jsx("button",{type:"button",className:`py-1 px-2 rounded-md transition-colors ${e.selectedDays.includes(r.value)?"bg-blue-500 text-white":"bg-gray-200 text-gray-700"}`,onClick:()=>x(t,r.value),children:r.label},r.value))}),(0,s.jsxs)("div",{className:"mt-6 flex space-x-4",children:[s.jsx("button",{type:"submit",className:"w-full bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-500 transition-colors text-sm",children:"Сохранить"}),s.jsx("button",{type:"button",onClick:()=>f(t),className:"w-full bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700 transition-colors text-sm",children:"Удалить"})]})]},t)),s.jsx("div",{className:"mt-6 flex justify-center",children:s.jsx("button",{type:"button",onClick:()=>{let t=`grafik_${u}_${Date.now()}`;c(r=>[...r,{grafikName:t,specialistId:e,startTime:"00:00",endTime:"00:00",interval:15,selectedDays:[]}]),m(u+1)},className:"bg-green-500 text-white py-2 px-4 rounded-md hover:bg-green-600 transition-colors text-sm",children:"+ Добавить график"})})]})]})}},89500:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var s=r(17577);let a=()=>{let[e,t]=(0,s.useState)(null),[r,a]=(0,s.useState)(),[i,n]=(0,s.useState)(!0),[l,o]=(0,s.useState)(null);return(0,s.useEffect)(()=>{let e=window.Telegram.WebApp;e.ready();let r=e.initDataUnsafe?.user;if(r){t(r);let e="6874087551:AAHHCPMYy9JXgHVBavUdce_YjoXWgd0Fuew";fetch(`https://api.telegram.org/bot${e}/getUserProfilePhotos?user_id=${r.id}`).then(e=>{if(!e.ok)throw Error("Ошибка получения данных от Telegram API");return e.json()}).then(t=>{if(t?.result?.photos?.length>0){let r=t.result.photos[0][0].file_id;return fetch(`https://api.telegram.org/bot${e}/getFile?file_id=${r}`)}throw Error("Фотографии профиля не найдены")}).then(e=>{if(!e.ok)throw Error("Ошибка получения файла с Telegram API");return e.json()}).then(t=>{if(t?.result?.file_path)a(`https://api.telegram.org/file/bot${e}/${t.result.file_path}`);else throw Error("Путь к файлу не найден")}).catch(e=>{console.error("Ошибка получения фото профиля:",e),o(e.message),a("/placeholder-image.jpg")}).finally(()=>n(!1))}else n(!1)},[]),{telegram_user:e,userPhoto:r,loading:i,error:l}}},59055:(e,t,r)=>{"use strict";r.d(t,{W:()=>a});let s=new(r(53524)).PrismaClient;async function a(e){try{return await s.timeSlots.findMany({where:{specialistId:e}})}catch(e){return console.error("Ошибка при загрузке графика специалиста:",e),null}}},58873:(e,t,r)=>{"use strict";r.d(t,{x:()=>a});let s=new(r(53524)).PrismaClient;async function a(e){try{return await s.specialist.findFirst({where:{userId:e}})}catch(e){return console.error("Ошибка при загрузке графика специалиста:",e),null}}},84443:(e,t,r)=>{"use strict";r.d(t,{ZP:()=>l});var s=r(68570);let a=(0,s.createProxy)(String.raw`D:\Projects\NEWWEBAPPTELEGA\web-app\src\app\components\Container.tsx`),{__esModule:i,$$typeof:n}=a;a.default;let l=(0,s.createProxy)(String.raw`D:\Projects\NEWWEBAPPTELEGA\web-app\src\app\components\Container.tsx#default`)},39876:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var s=r(19510),a=r(84443),i=r(68570);let n=(0,i.createProxy)(String.raw`D:\Projects\NEWWEBAPPTELEGA\web-app\src\app\grafik\[userId]\client.tsx`),{__esModule:l,$$typeof:o}=n;n.default;let d=(0,i.createProxy)(String.raw`D:\Projects\NEWWEBAPPTELEGA\web-app\src\app\grafik\[userId]\client.tsx#default`);var c=r(58873),u=r(59055);async function m({params:e}){let t=await (0,c.x)(e.userId),r=await (0,u.W)(e.userId);return s.jsx("div",{children:s.jsx(a.ZP,{children:s.jsx(d,{specialistId:t?.userId,grafik:r})})})}},32029:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o,metadata:()=>l});var s=r(19510),a=r(25384),i=r.n(a);r(5023),r(83952);var n=r(9720);let l={title:"Create Next App",description:"Generated by create next app"};function o({children:e}){return(0,s.jsxs)("html",{lang:"en",children:[(0,s.jsxs)("head",{children:[s.jsx(n.default,{strategy:"beforeInteractive",src:"https://telegram.org/js/telegram-web-app.js"}),s.jsx(n.default,{strategy:"beforeInteractive",src:"https://cdn.jsdelivr.net/npm/eruda"})]}),s.jsx("body",{className:i().className,children:s.jsx("div",{className:"pb-6 pt-6 bg-slate-100",children:e})})]})}},73881:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});var s=r(66621);let a=e=>[{type:"image/x-icon",sizes:"16x16",url:(0,s.fillMetadataSegment)(".",e.params,"favicon.ico")+""}]},5023:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,206,339,703,689],()=>r(46543));module.exports=s})();